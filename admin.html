<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Happy Store</title>

<style>
body { font-family: Arial, sans-serif; background:#f5f5f5; padding:20px; }
.login, .form-container { max-width:400px; margin:50px auto; background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
input, select, textarea { width:100%; padding:10px; margin:10px 0; border-radius:6px; border:1px solid #ccc; }
button { width:100%; padding:12px; border:none; border-radius:6px; background:#FF002F; color:white; cursor:pointer; font-weight:bold; }
button:hover { background:#cc0026; }
</style>

</head>
<body>

<!-- LOGIN -->
<div class="login" id="loginBox">
<h2>Admin Login</h2>
<input type="text" id="user" placeholder="Usuario">
<input type="password" id="pass" placeholder="Contraseña">
<button onclick="login()">Entrar</button>
</div>

<!-- FORMULARIO -->
<div class="form-container" id="adminForm" style="display:none;">
<h2>Agregar Producto</h2>

<input type="text" id="codigo" placeholder="Código del producto" readonly>
<input type="text" id="nombre" placeholder="Nombre">
<textarea id="descripcion" placeholder="Descripción"></textarea>
<input type="number" id="precio" placeholder="Precio">
<input type="number" id="valoracion" placeholder="Valoración (0-10)" min="0" max="10">

<select id="estado">
<option value="disponible">Disponible</option>
<option value="reservado">Reservado</option>
<option value="vendido">Vendido</option>
</select>

<input type="url" id="img1" placeholder="URL imagen 1">
<input type="url" id="img2" placeholder="URL imagen 2">
<input type="url" id="img3" placeholder="URL imagen 3">
<input type="url" id="img4" placeholder="URL imagen 4">
<input type="url" id="img5" placeholder="URL imagen 5">

<button onclick="agregarProducto()">Agregar Producto</button>
</div>

<script>
// LOGIN SIMPLE
function login(){
const user = document.getElementById('user').value;
const pass = document.getElementById('pass').value;

if(user === 'admin' && pass === '1234'){
document.getElementById('loginBox').style.display='none';
document.getElementById('adminForm').style.display='block';
}else{
alert("Usuario incorrecto");
}
}
</script>

<!-- FIREBASE + FIRESTORE -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyD8R7O8TMyzhvY1B14iBl95DFtkH2xwZiI",
authDomain: "happy-store-pe.firebaseapp.com",
projectId: "happy-store-pe",
storageBucket: "happy-store-pe.firebasestorage.app",
messagingSenderId: "937721773162",
appId: "1:937721773162:web:67a5aec14f8103bc9e5e13"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
async function generarCodigoUnico() {
    const productosRef = collection(db, "productos");
    const q = query(productosRef, orderBy("codigo", "desc"), limit(1)); // trae el último código
    const snapshot = await getDocs(q);

    let nuevoCodigo = "HS-001"; // por defecto si no hay productos
    snapshot.forEach(doc => {
        const ultimoCodigo = doc.data().codigo; // ejemplo: "HS-007"
        const numero = parseInt(ultimoCodigo.split('-')[1]);
        const siguiente = numero + 1;
        nuevoCodigo = "HS-" + String(siguiente).padStart(3, '0'); // mantiene formato HS-001
    });

    return nuevoCodigo;
}
window.agregarProducto = async function(){

const producto = {
codigo: await generarCodigoUnico(),
nombre: document.getElementById('nombre').value,
descripcion: document.getElementById('descripcion').value,
precio: Number(document.getElementById('precio').value),
condicion: Number(document.getElementById('valoracion').value),
estado: document.getElementById('estado').value,
fecha_reserva: null,
fotos: [
document.getElementById('img1').value,
document.getElementById('img2').value,
document.getElementById('img3').value,
document.getElementById('img4').value,
document.getElementById('img5').value
]
};

await addDoc(collection(db,"productos"), producto);

alert("Producto guardado correctamente");

document.querySelectorAll('#adminForm input, #adminForm textarea').forEach(i=>i.value="");

}

</script>

</body>
</html>
